<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>포켓몬 도감 정보</title>
    <style>
        :root {
            --sidebar-width: 240px; --primary-color: #3498db; --background-color: #f4f6f9;
            --top-ad-banner-height: 90px;
        }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--background-color); padding-top: var(--top-ad-banner-height); }
        .top-ad-banner {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--top-ad-banner-height);
            background-color: #fff; border-bottom: 1px solid #e0e0e0;
            z-index: 1000; display: flex; align-items: center; justify-content: center;
        }
        .app-container { display: flex; height: calc(100vh - var(--top-ad-banner-height)); }
        .sidebar {
            width: var(--sidebar-width); background-color: #2c3e50; color: white;
            padding: 15px; flex-shrink: 0; overflow-y: auto;
        }
        .sidebar h1 { font-size: 1.6em; text-align: center; margin-bottom: 25px; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar .nav-menu li { padding: 13px 20px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; font-size: 1.1em;}
        .sidebar .nav-menu li.active { background-color: var(--primary-color); }
        .main-content { flex-grow: 1; display: flex; overflow-x: auto; position: relative; }
        .content-column {
            display: none; /* 기본적으로 모든 컬럼 숨김 */
            min-width: 320px; background-color: white; border-right: 1px solid #e9e9e9;
            padding: 25px; overflow-y: auto; flex-shrink: 0; box-sizing: border-box;
        }
        /* --- PC 화면 구성 제어 (CSS) --- */
        .main-content[data-depth='1'] #column-lev2,
        .main-content[data-depth='2'] #column-lev2, .main-content[data-depth='2'] #column-lev3,
        .main-content[data-depth='3'] #column-lev2, .main-content[data-depth='3'] #column-lev3, .main-content[data-depth='3'] #column-lev4,
        .main-content[data-depth='4'] #column-lev2, .main-content[data-depth='4'] #column-lev3, .main-content[data-depth='4'] #column-lev4 {
            display: block;
        }
        /* 최종 화면 규칙: 중간 컬럼 숨기기 */
        .main-content[data-is-final='true'][data-depth='2'] #column-lev2 { display: none; }
        .main-content[data-is-final='true'][data-depth='3'] #column-lev2, .main-content[data-is-final='true'][data-depth='3'] #column-lev3 { display: none; }
        
        .list-item { padding: 12px; margin-bottom: 8px; border-radius: 6px; cursor: pointer; border: 1px solid #ddd; font-size:1.05em; }
        .icon-grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; }
        .icon-button {
            padding: 12px; border-radius: 30px; text-align: center; color: white; font-weight: bold;
            cursor: pointer; border: 2px solid rgba(0,0,0,0.05); text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .detail-section h3 { border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 15px; font-size: 1.4em; color: #c0392b; }
        .detail-view-container img { max-width: 120px; float: left; margin: 0 20px 10px 0; border-radius: 8px; }
        .detail-view-container pre { white-space: pre-wrap; word-wrap: break-word; font-family: inherit; font-size: 1.1em; line-height: 1.7; }
        .top-controls { display: none; }
        .btn-back-pc { display: none; margin-bottom: 15px; padding: 8px 12px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; }
        
        @media (max-width: 768px) {
            body { padding-top: calc(var(--top-ad-banner-height) + 50px); }
            .top-controls {
                display: flex; justify-content: space-between; align-items: center;
                position: fixed; top: var(--top-ad-banner-height); left: 0; width: 100%;
                background-color: #2c3e50; color: white; padding: 10px 15px;
                z-index: 900; box-sizing: border-box;
            }
            .sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); z-index: 1100; transition: transform 0.3s ease; }
            .sidebar.show { transform: translateX(0); }
            .app-container { height: calc(100vh - (var(--top-ad-banner-height) + 50px)); }
            .main-content { overflow: hidden; }
            .content-column {
                display: block; visibility: hidden;
                position: absolute; width: 100%; height: 100%;
                min-width: 100%; box-sizing: border-box; top: 0; left: 0;
                transform: translateX(100%); transition: transform 0.3s ease-in-out;
            }
            .content-column.active { visibility: visible; transform: translateX(0%); }
        }
    </style>
</head>
<body>
    <div class="top-ad-banner" id="top-ad-banner"></div>
    <div class="app-container">
        <aside class="sidebar" id="sidebar"></aside>
        <main class="main-content" id="main-content">
            <div class="content-column" id="column-lev2"></div>
            <div class="content-column" id="column-lev3"></div>
            <div class="content-column" id="column-lev4"></div>
        </main>
    </div>
    <div class="top-controls">
        <button id="btn-menu" style="background:none; border:none; color:white; font-size:1.2em;">☰ 메뉴</button>
        <h2 id="mobile-title" style="margin:0; font-size:1.1em; color:white;"></h2>
        <button id="btn-back-mobile" style="display: none; background:none; border:none; color:white; font-size:1.1em;">‹ 뒤로</button>
    </div>

    <script src="data.js"></script>
    <script>
        const isAdmin = new URLSearchParams(window.location.search).get('admin') === 'true';
        const sidebarEl = document.getElementById('sidebar');
        const mainContentEl = document.getElementById('main-content');
        const columns = { lev2: document.getElementById('column-lev2'), lev3: document.getElementById('column-lev3'), lev4: document.getElementById('column-lev4') };
        const btnMenu = document.getElementById('btn-menu');
        const btnBackMobile = document.getElementById('btn-back-mobile');
        const mobileTitle = document.getElementById('mobile-title');
        let navigationStack = [];

        const goBack = () => { if (navigationStack.length > 1) { navigationStack.pop(); renderView(); } };
        
        const handleItemClick = (depth, newKey) => {
            const currentCategory = navigationStack[0].category;
            navigationStack = navigationStack.slice(0, depth + 1);
            navigationStack.push({ category: currentCategory, key: newKey });
            renderView();
        };

        const renderView = () => {
            Object.values(columns).forEach(col => {
                col.innerHTML = ''; // ★★★ 핵심 수정: 컬럼을 부수지 않고 내용만 비웁니다.
                col.classList.remove('active');
            });

            mainContentEl.dataset.depth = navigationStack.length;
            if (navigationStack.length === 0) {
                btnBackMobile.style.display = 'none';
                mobileTitle.textContent = '메뉴 선택';
                if (window.innerWidth <= 768) sidebarEl.classList.remove('show');
                return;
            }

            const isMobile = window.innerWidth <= 768;
            const currentState = navigationStack[navigationStack.length - 1];
            const config = categoryConfig[currentState.category];
            const currentDepth = navigationStack.length - 1;
            const isFinalView = config.renderType.length === navigationStack.length;

            mobileTitle.textContent = currentState.key || config.title;
            mainContentEl.dataset.isFinal = isFinalView;
            if(isFinalView) { refreshTopAd(); }

            navigationStack.forEach((state, index) => renderColumn(state, index));

            if(isMobile) {
                sidebarEl.classList.remove('show');
                const lastColId = `column-${config.levels[currentDepth]}`;
                const lastCol = document.getElementById(lastColId);
                if(lastCol) lastCol.classList.add('active');
            }
            btnBackMobile.style.display = navigationStack.length > 0 ? 'block' : 'none';
        };

        const renderColumn = (state, depth) => {
            const { category, key } = state;
            const config = categoryConfig[category];
            const columnEl = columns[config.levels[depth]];
            if (!columnEl) return;
            
            const backButtonPC = document.createElement('button');
            backButtonPC.className = 'btn-back-pc'; backButtonPC.textContent = '‹ 목록으로 돌아가기';
            backButtonPC.onclick = goBack;
            if (depth > 0 || (depth === 0 && config.renderType[0] === 'detail')) {
                backButtonPC.style.display = 'block';
            }
            columnEl.appendChild(backButtonPC);

            const sourceData = database[config.dataKeys[depth]];
            const renderType = config.renderType[depth];

            if (renderType === 'list') {
                const title = document.createElement('h2');
                const prevKey = depth > 0 ? navigationStack[depth - 1].key : null;
                title.textContent = key || config.title;
                columnEl.appendChild(title);
                const listData = (depth === 0) ? Object.keys(sourceData) : (sourceData[prevKey] || []);
                const container = config.listStyle === 'icon-button' ? document.createElement('div') : columnEl;
                if (config.listStyle === 'icon-button') {
                    container.className = 'icon-grid-container';
                    columnEl.appendChild(container);
                }
                listData.forEach(itemKey => {
                    const itemEl = document.createElement('div');
                    itemEl.textContent = itemKey;
                    itemEl.onclick = () => handleItemClick(depth, itemKey);
                    switch (config.listStyle) {
                        case 'icon-button': itemEl.className = 'icon-button'; itemEl.style.backgroundColor = typeColors[itemKey] || '#ccc'; break;
                        case 'color-text': itemEl.className = 'list-item'; itemEl.style.color = itemColors[itemKey] || '#333'; itemEl.style.fontWeight = 'bold'; break;
                        default: itemEl.className = 'list-item'; break;
                    }
                    container.appendChild(itemEl);
                });
            } else if (renderType === 'detail') {
                const detailData = sourceData[key];
                if (detailData) {
                    const contentDiv = document.createElement('div');
                    contentDiv.innerHTML = config.detailRenderer(detailData, key);
                    columnEl.appendChild(contentDiv);
                }
            }
        };
        
        const init = () => {
            if (isAdmin) console.log("운영자 모드 활성화.");
            sidebarEl.innerHTML = `<h1>포켓몬 정보</h1><ul class="nav-menu" id="main-nav">
                <li data-category="pokemonType">포켓몬 타입</li><li data-category="pokemonGrade">포켓몬 등급</li>
                <li data-category="item">아이템</li><li data-category="rune">룬</li><li data-category="chip">칩</li>
                <li data-category="recommendedDeck">추천 덱</li><li data-category="calendar">캘린더</li>
                <li data-category="tips">팁 & 노하우</li></ul>`;
            document.getElementById('main-nav').addEventListener('click', e => {
                if (e.target.tagName === 'LI') {
                    const category = e.target.dataset.category;
                    sidebarEl.querySelector('.active')?.classList.remove('active');
                    e.target.classList.add('active');
                    navigationStack = [{ category: category, key: null }];
                    renderView();
                }
            });
            btnBackMobile.addEventListener('click', goBack);
            btnMenu.addEventListener('click', () => sidebarEl.classList.toggle('show'));
            window.addEventListener('resize', renderView);
            refreshTopAd();
        };
        init();
    </script>
</body>
</html>
