<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>포켓몬 도감 정보 - 2.4단계 (최종 수정)</title>
    <style>
        body, h1, h2, ul, li { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f4f6f9; }
        .sidebar {
            width: 240px; background-color: #2c3e50; color: white;
            padding: 20px; flex-shrink: 0;
        }
        .sidebar h1 { text-align: center; margin-bottom: 30px; }
        .sidebar .nav-menu { list-style: none; }
        .sidebar .nav-menu li {
            padding: 13px 20px; margin-bottom: 10px; border-radius: 8px;
            cursor: pointer; transition: background-color 0.2s;
        }
        .sidebar .nav-menu li.active { background-color: #3498db; }
        .main-content { flex-grow: 1; display: flex; overflow-x: auto; }
        .content-column {
            min-width: 320px; background-color: white;
            border-right: 1px solid #e9e9e9;
            padding: 25px;
        }
        .content-column h2 { margin-top: 0; }
        .list-item {
            padding: 12px; margin-bottom: 8px; border-radius: 6px;
            cursor: pointer; border: 1px solid #ddd;
        }
        .list-item:hover { background-color: #f0f0f0; }
        .btn-back {
            margin-bottom: 15px; padding: 8px 12px;
            background-color: #6c757d; color: white;
            border: none; border-radius: 4px; cursor: pointer;
        }
        .btn-back:hover { background-color: #5a6268; }
        .detail-image {
             max-width: 150px;
             display: block;
             margin-bottom: 15px;
             border-radius: 8px;
        }
        .top-controls { display: none; }
        @media (max-width: 768px) {
            .top-controls {
                display: flex; justify-content: space-between; align-items: center;
                position: fixed; top: 0; left: 0; width: 100%; height: 50px;
                background-color: #2c3e50; color: white;
                padding: 0 15px; z-index: 1000; box-sizing: border-box;
            }
            .sidebar {
                position: fixed; top: 0; left: 0; height: 100%;
                transform: translateX(-100%); z-index: 1100;
                transition: transform 0.3s ease;
            }
            .sidebar.show { transform: translateX(0); }
            .app-container { padding-top: 50px; height: calc(100vh - 50px); }
            .main-content { position: absolute; top: 50px; left: 0; right: 0; bottom: 0; overflow: hidden; }
            .content-column {
                position: absolute; width: 100%; height: 100%;
                transform: translateX(100%); transition: transform 0.3s ease-in-out;
                background-color: white;
            }
            .content-column.active { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <h1>포켓몬 정보</h1>
        <ul class="nav-menu">
            <li data-category="pokemonType">포켓몬 타입</li>
            <li data-category="pokemonGrade">포켓몬 등급</li>
            <li data-category="item">아이템</li>
            <li data-category="rune">룬</li>
            <li data-category="chip">칩</li>
            <li data-category="recommendedDeck">추천 덱</li>
            <li data-category="calendar">캘린더</li>
            <li data-category="tips">팁 & 노하우</li>
        </ul>
    </aside>
    <main class="main-content" id="main-content"></main>
    <div class="top-controls" id="top-controls">
        <button id="btn-menu" style="background:none; border:none; color:white; font-size:1.2em;">☰ 메뉴</button>
        <h2 id="mobile-title" style="margin:0; font-size:1.1em; color:white;"></h2>
        <button id="btn-back-mobile" style="display: none; background:none; border:none; color:white; font-size:1.1em;">‹ 뒤로</button>
    </div>

    <script src="data.js"></script>
    <script>
        const sidebarEl = document.getElementById('sidebar');
        const mainContentEl = document.getElementById('main-content');
        const topControlsEl = document.getElementById('top-controls');
        const mobileTitleEl = document.getElementById('mobile-title');
        const btnMenu = document.getElementById('btn-menu');
        const btnBackMobile = document.getElementById('btn-back-mobile');
        let navigationPath = [];

        const goBack = () => {
            if (navigationPath.length > 1) {
                navigationPath.pop();
                renderContent();
            }
        };

        const handleItemClick = (newKey) => {
            navigationPath.push(newKey);
            renderContent();
        };

        const renderContent = () => {
            mainContentEl.innerHTML = '';
            const isMobile = window.innerWidth <= 768;

            if (navigationPath.length === 0) {
                if(isMobile) topControlsEl.style.display = 'none';
                return;
            }
            
            if(isMobile) {
                sidebarEl.classList.remove('show');
                topControlsEl.style.display = 'flex';
                btnBackMobile.style.display = navigationPath.length > 1 ? 'block' : 'none';
                const currentKey = navigationPath[navigationPath.length - 1];
                const categoryName = document.querySelector(`[data-category="${navigationPath[0]}"]`).textContent;
                mobileTitleEl.textContent = navigationPath.length > 1 ? currentKey : categoryName;
            }

            const currentCategory = navigationPath[0];
            const config = categoryConfig[currentCategory];
            if (!config) return;

            let columnsToRender = [];
            for (let depth = 1; depth <= navigationPath.length; depth++) {
                const columnEl = document.createElement('div');
                columnEl.className = 'content-column';
                populateColumn(columnEl, currentCategory, depth);
                columnsToRender.push(columnEl);
            }
            mainContentEl.append(...columnsToRender);

            if(isMobile) {
                const lastColumn = mainContentEl.querySelector('.content-column:last-child');
                if (lastColumn) lastColumn.classList.add('active');
            }
        };

        const populateColumn = (columnEl, category, depth) => {
            // ★★★ 핵심 수정: 뒤로가기 버튼 생성 로직을 더 위로 올리고, 이벤트 리스너를 다시 확인합니다.
            if (depth > 1) {
                const backButton = document.createElement('button');
                backButton.className = 'btn-back';
                backButton.textContent = '‹ 뒤로가기';
                backButton.addEventListener('click', goBack);
                columnEl.appendChild(backButton);
            }
            
            const config = categoryConfig[category];
            const renderType = config.renderType[depth - 1];
            // ★★★ 핵심 수정: 데이터 조회를 위한 키 값을 명확하게 수정합니다.
            const dataKey = navigationPath[depth - 1];
            const listDataKey = navigationPath[depth - 1];
            
            const title = document.createElement('h2');
            title.textContent = dataKey === category ? config.title : dataKey;
            columnEl.appendChild(title);

            if (renderType === 'list') {
                const sourceData = database[config.dataKeys[depth - 1]];
                const listData = (depth === 1) ? Object.keys(sourceData) : (sourceData[listDataKey] || []);
                listData.forEach(itemKey => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'list-item';
                    itemEl.textContent = itemKey;
                    itemEl.addEventListener('click', () => handleItemClick(itemKey));
                    columnEl.appendChild(itemEl);
                });
            } else if (renderType === 'detail') {
                const sourceData = database[config.dataKeys[depth - 1]];
                const detailData = sourceData[dataKey];
                if (detailData && config.detailRenderer) {
                    columnEl.innerHTML += config.detailRenderer(detailData);
                } else {
                    columnEl.innerHTML += `<p>상세 정보가 없습니다.</p>`;
                }
            }
        };

        const navItems = sidebarEl.querySelectorAll('.nav-menu li');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                const category = item.dataset.category;
                navigationPath = [category];
                renderContent();
            });
        });

        btnMenu.addEventListener('click', () => sidebarEl.classList.toggle('show'));
        btnBackMobile.addEventListener('click', goBack);
    </script>
</body>
</html>
