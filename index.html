<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>포켓몬 도감</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            background-color: #2c3e50;
            color: #ecf0f1;
            width: 250px;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            height: 100%;
            overflow-y: auto;
            z-index: 500;
        }
        .sidebar h2 {
            font-size: 1.8em;
            margin-bottom: 30px;
            color: #3498db;
            text-align: center;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
        }
        .sidebar ul li {
            margin-bottom: 10px;
        }
        .sidebar ul li a {
            color: #ecf0f1;
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .sidebar ul li a:hover, .sidebar ul li a.active {
            background-color: #34495e;
            color: #ffffff;
        }
        .main-content-wrapper {
            margin-left: 250px;
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* AdSense 광고 컨테이너 */
        .ads-container {
            width: 100%;
            min-height: 90px;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }

        .content-area {
            flex-grow: 1;
            display: flex;
            gap: 20px;
        }
        .content-section {
            display: none;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-grow: 1;
            min-height: 600px;
            overflow-y: auto;
            position: relative;
        }
        .content-section.active {
            display: flex;
            flex-direction: column;
        }
        .level-column-wrapper {
            flex-grow: 1;
            display: flex;
            gap: 20px;
            flex-wrap: nowrap;
        }
        .level-column {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
            min-height: 400px;
            overflow-y: auto;
            flex-shrink: 0;
            display: none; /* Default hidden, controlled by JS */
        }
        .level-column.list-view {
            width: 35%;
        }
        .level-column.detail-view {
            width: 65%;
        }
        /* For PC, show lv2 and lv3/lv4 by default in relevant sections */
        .content-section.active .level-column.list-view,
        .content-section.active .level-column.detail-view {
            display: block;
        }
        .level-column h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .level-column ul {
            list-style: none;
            padding: 0;
        }
        .level-column ul li {
            margin-bottom: 8px;
        }
        .level-column ul li a {
            display: block;
            padding: 8px 10px;
            background-color: #ecf0f1;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s ease;
        }
        .level-column ul li a:hover, .level-column ul li a.active {
            background-color: #3498db;
            color: #fff;
        }
        .detail-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: 100%; /* Ensure it fills parent */
        }
        .detail-content h4 {
            font-size: 2em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .detail-content img {
            max-width: 150px;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .detail-content p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .detail-content strong {
            color: #3498db;
        }
        .detail-content .back-button {
            margin-top: 20px;
            float: right;
        }
        .pokemon-detail-card {
            background-color: #f0f2f5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }
        .pokemon-detail-card strong {
            color: #2c3e50;
        }
        .pokemon-detail-card .clickable-item {
            color: #3498db;
            cursor: pointer;
            text-decoration: underline;
        }
        .pokemon-detail-card .clickable-item:hover {
            color: #2980b9;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }
        .modal-body img {
            max-width: 120px;
            height: auto;
            display: block;
            margin: 0 auto 15px auto;
            border-radius: 8px;
        }
        .modal-body h4 {
            font-size: 1.8em;
            margin-bottom: 10px;
            color: #2c3e50;
            text-align: center;
        }
        .modal-body p {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        /* Mobile Responsive Adjustments */
        @media (max-width: 1024px) {
            body {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: none;
                padding: 10px;
            }
            .sidebar ul {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .sidebar ul li {
                margin: 5px;
            }
            .main-content-wrapper {
                margin-left: 0;
                padding: 15px;
            }
            .content-area {
                flex-direction: column;
                gap: 0;
            }
            .content-section {
                padding: 15px;
                flex-direction: column;
                height: auto;
                width: 100%;
            }
            .level-column-wrapper {
                flex-direction: column;
                gap: 15px;
            }
            .level-column {
                width: 100%;
                min-height: auto;
                display: block; /* Always visible on mobile, visibility handled by JS */
            }

            /* Mobile-specific view toggling */
            /* Initial state for content-section (empty screen on right) */
            .content-section:not(.has-content) .level-column.list-view { display: none; }
            .content-section:not(.has-content) .level-column.detail-view { display: none; } /* Both hidden */

            /* Mobile: Only current active column is displayed */
            .content-section.active .level-column { display: none; }
            .content-section.active .level-column.active-mobile-column { display: block; }

            .level-column .back-button {
                display: block; /* Always visible on mobile for navigation */
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>포켓몬 도감</h2>
        <ul>
            <li><a href="#" onclick="showSection('pokemon-type', this)" class="active">포켓몬 타입</a></li>
            <li><a href="#" onclick="showSection('pokemon-grade', this)">포켓몬 등급</a></li>
            <li><a href="#" onclick="showSection('item', this)">아이템</a></li>
            <li><a href="#" onclick="showSection('rune', this)">룬</a></li>
            <li><a href="#" onclick="showSection('chip', this)">칩</a></li>
            <li><a href="#" onclick="showSection('recommended-decks', this)">추천 덱</a></li>
            <li><a href="#" onclick="showSection('calendar', this)">캘린더</a></li>
            <li><a href="#" onclick="showSection('tips-knowhow', this)">팁 & 노하우</a></li>
        </ul>
    </div>

    <div class="main-content-wrapper">
        <div class="ads-container" id="top-ad-container">
            <ins class="adsbygoogle"
                 style="display:block; text-align:center;"
                 data-ad-client="ca-pub-2125965839205311"
                 data-ad-slot="5532734526"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>

        <div class="content-area">
            <div id="initial-blank-section" class="content-section active">
                <h1 class="text-3xl font-bold mb-4">환영합니다!</h1>
                <p>좌측 메뉴에서 원하는 정보를 선택해주세요.</p>
            </div>

            <div id="pokemon-type-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">포켓몬 타입 정보</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-pokemon-type">
                        <h3>타입 목록</h3>
                        <ul id="pokemon-type-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-list-pokemon-by-type">
                        <h3>타입별 포켓몬</h3>
                        <ul id="pokemon-by-type-list"></ul>
                        <button onclick="backToLv2('pokemon-type')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                    <div class="level-column detail-view" id="lv4-detail-pokemon-type">
                        <h3>포켓몬 상세 정보</h3>
                        <div id="pokemon-type-detail-content" class="detail-content pokemon-detail-section">
                            <img id="pokemon-type-image" src="" alt="포켓몬 이미지" class="hidden">
                            <h4 id="pokemon-type-title" class="text-xl font-bold mb-2"></h4>
                            <p id="pokemon-type-description"></p>
                            <h5 class="text-xl font-bold mb-2">스킬:</h5>
                            <div id="pokemon-type-skills"></div>
                            <p><strong>성격:</strong> <span id="pokemon-type-nature"></span></p>
                            <p><strong>빌드:</strong> <span id="pokemon-type-build"></span></p>
                            <p><strong>아이템:</strong> <span id="pokemon-type-item" class="clickable-item"></span></p>
                            <p><strong>룬:</strong> <span id="pokemon-type-runes" class="clickable-item"></span></p>
                            <p><strong>칩:</strong> <span id="pokemon-type-chips" class="clickable-item"></span></p>
                            <p><strong>추천 팀:</strong> <span id="pokemon-type-team"></span></p>
                            <button onclick="backToLv3('pokemon-type')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">이전으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="pokemon-grade-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">포켓몬 등급 정보</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-pokemon-grade">
                        <h3>등급 목록</h3>
                        <ul id="pokemon-grade-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-list-pokemon-by-grade">
                        <h3>등급별 포켓몬</h3>
                        <ul id="pokemon-by-grade-list"></ul>
                        <button onclick="backToLv2('pokemon-grade')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                    <div class="level-column detail-view" id="lv4-detail-pokemon-grade">
                        <h3>포켓몬 상세 정보</h3>
                        <div id="pokemon-grade-detail-content" class="detail-content pokemon-detail-section">
                            <img id="pokemon-grade-image" src="" alt="포켓몬 이미지" class="hidden">
                            <h4 id="pokemon-grade-title" class="text-xl font-bold mb-2"></h4>
                            <p id="pokemon-grade-description"></p>
                            <h5 class="text-xl font-bold mb-2">스킬:</h5>
                            <div id="pokemon-grade-skills"></div>
                            <p><strong>성격:</strong> <span id="pokemon-grade-nature"></span></p>
                            <p><strong>빌드:</strong> <span id="pokemon-grade-build"></span></p>
                            <p><strong>아이템:</strong> <span id="pokemon-grade-item" class="clickable-item"></span></p>
                            <p><strong>룬:</strong> <span id="pokemon-grade-runes" class="clickable-item"></span></p>
                            <p><strong>칩:</strong> <span id="pokemon-grade-chips" class="clickable-item"></span></p>
                            <p><strong>추천 팀:</strong> <span id="pokemon-grade-team"></span></p>
                            <button onclick="backToLv3('pokemon-grade')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">이전으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="item-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">아이템 정보</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-item">
                        <h3>아이템 목록</h3>
                        <ul id="item-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-detail-item">
                        <h3>상세 정보</h3>
                        <div id="item-detail-content" class="detail-content">
                            <img id="item-image" src="" alt="아이템 이미지" class="hidden">
                            <h4 id="item-title" class="text-xl font-bold mb-2"></h4>
                            <p id="item-description"></p>
                            <button onclick="backToLv2('item')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="rune-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">룬 정보</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-rune">
                        <h3>룬 목록</h3>
                        <ul id="rune-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-detail-rune">
                        <h3>상세 정보</h3>
                        <div id="rune-detail-content" class="detail-content">
                            <img id="rune-image" src="" alt="룬 이미지" class="hidden">
                            <h4 id="rune-title" class="text-xl font-bold mb-2"></h4>
                            <p id="rune-description"></p>
                            <button onclick="backToLv2('rune')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="chip-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">칩 정보</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-chip">
                        <h3>칩 목록</h3>
                        <ul id="chip-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-detail-chip">
                        <h3>상세 정보</h3>
                        <div id="chip-detail-content" class="detail-content">
                            <img id="chip-image" src="" alt="칩 이미지" class="hidden">
                            <h4 id="chip-title" class="text-xl font-bold mb-2"></h4>
                            <p id="chip-description"></p>
                            <button onclick="backToLv2('chip')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="recommended-decks-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">추천 덱</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-recommended-decks">
                        <h3>덱 분류</h3>
                        <ul id="recommended-decks-type-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-detail-recommended-decks">
                        <h3>상세 정보</h3>
                        <div id="recommended-decks-detail-content" class="detail-content">
                            <img id="recommended-decks-image" src="" alt="덱 이미지" class="hidden">
                            <h4 id="recommended-decks-title" class="text-xl font-bold mb-2"></h4>
                            <p id="recommended-decks-description"></p>
                            <p><strong>구성 포켓몬:</strong> <span id="recommended-decks-pokemons"></span></p>
                            <p><strong>전략:</strong> <span id="recommended-decks-strategy"></span></p>
                            <button onclick="backToLv2('recommended-decks')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="calendar-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">이벤트 캘린더</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-calendar">
                        <h3>이벤트 타입</h3>
                        <ul id="calendar-type-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-detail-calendar">
                        <h3>상세 일정</h3>
                        <div id="calendar-detail-content" class="detail-content"></div>
                        <button onclick="backToLv2('calendar')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>

            <div id="tips-knowhow-section" class="content-section">
                <h1 class="text-3xl font-bold mb-4">팁 & 노하우</h1>
                <div class="level-column-wrapper">
                    <div class="level-column list-view active-mobile-column" id="lv2-list-tips-knowhow">
                        <h3>글 제목</h3>
                        <ul id="tips-knowhow-list"></ul>
                    </div>
                    <div class="level-column detail-view" id="lv3-detail-tips-knowhow">
                        <h3>글 내용</h3>
                        <div id="tips-knowhow-detail-content" class="detail-content">
                            <h4 id="tip-title" class="text-xl font-bold mb-2"></h4>
                            <p class="text-sm text-gray-600 mb-2">작성자: <span id="tip-author"></span> | 날짜: <span id="tip-date"></span></p>
                            <div id="tip-content"></div>
                        </div>
                        <button onclick="backToLv2('tips-knowhow')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="generalModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('generalModal')">&times;</span>
            <div class="modal-header">
                <h3 id="generalModalTitle" class="text-2xl font-bold mb-4"></h3>
            </div>
            <div class="modal-body" id="generalModalBody">
                <img id="generalModalImage" src="" alt="이미지" class="hidden">
                <p id="generalModalDescription"></p>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let activeSectionId = 'initial-blank-section';
        let activeLv2ListItem = null;
        let currentDetailLevel = ''; // 'lv1' (initial), 'lv2', 'lv3', 'lv4'

        const mediaQuery = window.matchMedia('(max-width: 1024px)');
        const adClient = "ca-pub-2125965839205311"; // 실제 AdSense 클라이언트 ID
        const adSlot = "5532734526"; // 실제 AdSense 슬롯 ID

        // 섹션 보이기/숨기기 함수 (Lev.1 클릭 시)
        function showSection(sectionId, clickedElement) {
            // 모든 섹션 숨김 (초기 공란 섹션 포함)
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            // 초기 공란 섹션은 항상 숨김
            document.getElementById('initial-blank-section').classList.remove('active');

            // 클릭된 섹션 활성화
            const targetSection = document.getElementById(sectionId + '-section');
            targetSection.classList.add('active');

            // 사이드바 링크 활성화 스타일 변경
            document.querySelectorAll('.sidebar ul li a').forEach(link => {
                link.classList.remove('active');
            });
            clickedElement.classList.add('active');

            activeSectionId = sectionId + '-section';

            // 모든 Level 2, 3, 4 컬럼 초기화 및 모바일/PC에 맞게 표시 설정
            resetAndDisplayColumns(sectionId);

            // 각 섹션에 맞는 초기 목록 로드 (항상 Lev.2 목록부터 시작)
            if (sectionId === 'pokemon-type') {
                loadPokemonTypeList();
            } else if (sectionId === 'pokemon-grade') {
                loadPokemonGradeList();
            } else if (sectionId === 'item') {
                loadItemRuneChipList('item');
            } else if (sectionId === 'rune') {
                loadItemRuneChipList('rune');
            } else if (sectionId === 'chip') {
                loadItemRuneChipList('chip');
            } else if (sectionId === 'recommended-decks') {
                loadRecommendedDeckTypeList();
            } else if (sectionId === 'calendar') {
                loadCalendarTypeList();
            } else if (sectionId === 'tips-knowhow') {
                loadTipsAndKnowhowList();
            }

            currentDetailLevel = 'lv2'; // 초기 레벨은 항상 LV2 목록

            // 광고 새로고침
            showAd();
        }

        // 섹션 전환 시 LV2/LV3/LV4 컬럼 상태 초기화 및 설정
        function resetAndDisplayColumns(sectionType) {
            const currentSection = document.getElementById(`${sectionType}-section`);
            if (!currentSection) return;

            // 모든 level-column 비활성화 및 상세 내용 초기화
            currentSection.querySelectorAll('.level-column').forEach(column => {
                column.classList.remove('active-mobile-column'); // 모바일 활성 컬럼 제거
                column.style.display = 'none'; // 기본적으로 모두 숨김
                // 해당 컬럼 내의 detail-content도 초기화
                const detailContent = column.querySelector('.detail-content');
                if (detailContent) {
                    resetDetailContent(detailContent, sectionType);
                }
            });

            // Lv2 목록은 항상 초기에는 보이도록 설정
            const lv2List = currentSection.querySelector('.level-column.list-view');
            if (lv2List) {
                lv2List.style.display = 'block';
                lv2List.classList.add('active-mobile-column'); // 모바일에서 LV2부터 시작
                lv2List.querySelector('ul').innerHTML = ''; // 목록 비우기
            }

            // PC 환경에서는 LV3/LV4 컬럼도 일단 보이게 설정
            if (!mediaQuery.matches) {
                currentSection.querySelectorAll('.level-column.detail-view').forEach(column => {
                    column.style.display = 'block';
                });
            }
        }

        // 상세 정보 컨테이너의 내용을 초기화하는 헬퍼 함수
        function resetDetailContent(detailContentElement, type) {
            if (!detailContentElement) return;

            // '목록으로 돌아가기' 버튼을 제외한 모든 내용 삭제
            Array.from(detailContentElement.children).forEach(child => {
                if (!child.classList.contains('back-button')) {
                    child.remove();
                }
            });

            // 각 섹션에 맞는 기본 플레이스홀더 요소들을 재구성
            // (HTML에 미리 정의된 요소들을 사용하도록 변경)
            let img = detailContentElement.querySelector('img');
            let h4 = detailContentElement.querySelector('h4');
            let descP = detailContentElement.querySelector('p:not(.text-sm.text-gray-600.mb-2)'); // 작성자/날짜 p 태그는 제외

            if (img) { img.src = ''; img.alt = ''; img.classList.add('hidden'); }
            if (h4) h4.textContent = '';
            if (descP) descP.textContent = '';


            // 포켓몬 상세 정보 관련 요소들 초기화 및 재생성 (없으면 생성)
            if (type.startsWith('pokemon')) { // 'pokemon-type' or 'pokemon-grade'
                let skillsH5 = detailContentElement.querySelector('h5');
                let skillsDiv = detailContentElement.querySelector('[id$="-skills"]');
                if (!skillsH5) {
                    skillsH5 = document.createElement('h5');
                    skillsH5.className = 'text-xl font-bold mb-2';
                    skillsH5.textContent = '스킬:';
                    detailContentElement.appendChild(skillsH5);
                }
                if (!skillsDiv) {
                    skillsDiv = document.createElement('div');
                    skillsDiv.id = `${type}-skills`;
                    detailContentElement.appendChild(skillsDiv);
                }
                skillsDiv.innerHTML = ''; // 스킬 내용 비우기

                const fields = ['nature', 'build', 'item', 'runes', 'chips', 'team'];
                fields.forEach(field => {
                    let pElement = detailContentElement.querySelector(`p strong:contains("${getFieldKoreanName(field)}")`)?.closest('p');
                    if (!pElement) { // p 태그가 없으면 새로 생성
                        pElement = document.createElement('p');
                        pElement.innerHTML = `<strong>${getFieldKoreanName(field)}:</strong> <span id="${type}-${field}"></span>`;
                        detailContentElement.appendChild(pElement);
                    }
                    let spanElement = pElement.querySelector(`span#${type}-${field}`);
                    if (spanElement) {
                        spanElement.textContent = '';
                        spanElement.className = ''; // clickable-item 클래스 제거
                        spanElement.onclick = null; // onclick 이벤트 핸들러 제거
                    }
                });
            }
            // 추천 덱 관련 span 초기화 및 재생성 (없으면 생성)
            else if (type === 'recommended-decks') {
                 const pokemonsP = detailContentElement.querySelector('p strong:contains("구성 포켓몬:")')?.closest('p');
                 const strategyP = detailContentElement.querySelector('p strong:contains("전략:")')?.closest('p');
                 if (pokemonsP) pokemonsP.querySelector('span').textContent = '';
                 if (strategyP) strategyP.querySelector('span').textContent = '';
                 // 이미지도 초기화
                 let img = detailContentElement.querySelector('img');
                 if (img) { img.src = ''; img.alt = ''; img.classList.add('hidden'); }
            }
            // 팁 & 노하우 작성자/날짜/내용 초기화
            else if (type === 'tips-knowhow') {
                const authorSpan = document.getElementById('tip-author');
                const dateSpan = document.getElementById('tip-date');
                const contentDiv = document.getElementById('tip-content');
                if (authorSpan) authorSpan.textContent = '';
                if (dateSpan) dateSpan.textContent = '';
                if (contentDiv) contentDiv.innerHTML = '';
            }

            // '목록으로 돌아가기' 버튼 텍스트 설정 (default)
            const backButton = detailContentElement.querySelector('.back-button');
            if (backButton) {
                backButton.textContent = '목록으로 돌아가기'; // 기본 텍스트
                if (mediaQuery.matches) {
                    backButton.style.display = 'block'; // 모바일에서는 기본적으로 보임
                } else {
                    backButton.style.display = 'none'; // PC에서는 숨김 (필요시 JS에서 변경)
                }
            }
        }

        // 필드명 한글화 헬퍼 (for resetDetailContent)
        function getFieldKoreanName(field) {
            const map = {
                'nature': '성격',
                'build': '빌드',
                'item': '아이템',
                'runes': '룬',
                'chips': '칩',
                'team': '추천 팀'
            };
            return map[field] || field;
        }

        // -- Level 2 목록 로드 함수들 --

        // 포켓몬 타입 목록 로드 (Lev.2)
        function loadPokemonTypeList() {
            const listUl = document.getElementById('pokemon-type-list');
            listUl.innerHTML = '';
            const uniqueTypes = new Set();
            window.pokemonData.forEach(p => p.type.forEach(t => uniqueTypes.add(t)));
            const sortedTypes = Array.from(uniqueTypes).sort();

            sortedTypes.forEach(type => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = type;
                link.onclick = (event) => {
                    event.preventDefault();
                    showPokemonListByTypeOrGrade(type, 'pokemon-type'); // Lev.3으로 이동
                    setActiveListItem(link);
                };
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });
            // 첫 번째 항목 선택 (PC에서는 목록이 채워지면 상세도 바로 보이도록)
            if (sortedTypes.length > 0) {
                listUl.querySelector('li a').click();
            }
        }

        // 포켓몬 등급 목록 로드 (Lev.2)
        function loadPokemonGradeList() {
            const listUl = document.getElementById('pokemon-grade-list');
            listUl.innerHTML = '';
            const uniqueGrades = new Set();
            window.pokemonData.forEach(p => uniqueGrades.add(p.grade));
            const sortedGrades = Array.from(uniqueGrades).sort((a,b) => {
                const gradeOrder = {'SS':3, 'S+':2, 'S':1, 'A':0};
                return (gradeOrder[b] || 0) - (gradeOrder[a] || 0);
            });

            sortedGrades.forEach(grade => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = grade;
                link.onclick = (event) => {
                    event.preventDefault();
                    showPokemonListByTypeOrGrade(grade, 'pokemon-grade'); // Lev.3으로 이동
                    setActiveListItem(link);
                };
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });
            // 첫 번째 항목 선택
            if (sortedGrades.length > 0) {
                listUl.querySelector('li a').click();
            }
        }

        // 아이템/룬/칩 목록 로드 (Lev.2)
        function loadItemRuneChipList(type) {
            let dataObject;
            let listElementId;
            if (type === 'item') { dataObject = window.itemDetails; listElementId = 'item-list'; }
            else if (type === 'rune') { dataObject = window.runeDetails; listElementId = 'rune-list'; }
            else if (type === 'chip') { dataObject = window.chipDetails; listElementId = 'chip-list'; }
            else return;

            const listUl = document.getElementById(listElementId);
            listUl.innerHTML = '';
            const keys = Object.keys(dataObject);

            keys.forEach(key => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = key;
                link.onclick = (event) => {
                    event.preventDefault();
                    showItemRuneChipDetail(key, type); // Lev.3으로 이동
                    setActiveListItem(link);
                };
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });
            // 첫 번째 항목 선택
            if (keys.length > 0) {
                listUl.querySelector('li a').click();
            }
        }

        // 추천 덱 분류 목록 로드 (Lev.2)
        function loadRecommendedDeckTypeList() {
            const listUl = document.getElementById('recommended-decks-type-list');
            listUl.innerHTML = '';

            const uniqueTypes = new Set();
            for (const deckName in window.recommendedDeckDetails) {
                const deck = window.recommendedDeckDetails[deckName];
                if (deck.type) { // deckDetails에 type 속성 추가 필요
                    uniqueTypes.add(deck.type);
                }
            }
            const sortedTypes = Array.from(uniqueTypes).sort();

            // '전체 덱' 옵션을 맨 앞에 추가 (없으면)
            if (!sortedTypes.includes('전체 덱') && Object.keys(window.recommendedDeckDetails).length > 0) {
                 sortedTypes.unshift('전체 덱');
            }


            sortedTypes.forEach(type => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = type;
                link.onclick = (event) => {
                    event.preventDefault();
                    showRecommendedDeckDetail(type); // Lev.3으로 이동 (덱 목록 대신 상세)
                    setActiveListItem(link);
                };
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });

            // 첫 번째 항목 선택
            if (sortedTypes.length > 0) {
                listUl.querySelector('li a').click();
            }
        }

        // 캘린더 이벤트 타입 목록 로드 (Lev.2)
        function loadCalendarTypeList() {
            const listUl = document.getElementById('calendar-type-list');
            listUl.innerHTML = '';

            const uniqueTypes = new Set();
            window.calendarEvents.forEach(event => uniqueTypes.add(event.type));
            const sortedTypes = Array.from(uniqueTypes).sort();

            sortedTypes.forEach(type => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = type;
                link.onclick = (event) => {
                    event.preventDefault();
                    showCalendarEventsByType(type); // Lev.3으로 이동
                    setActiveListItem(link);
                };
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });
            // 첫 번째 항목 선택
            if (sortedTypes.length > 0) {
                listUl.querySelector('li a').click();
            }
        }

        // 팁 & 노하우 제목 목록 로드 (Lev.2)
        function loadTipsAndKnowhowList() {
            const listUl = document.getElementById('tips-knowhow-list');
            listUl.innerHTML = '';

            window.tipsAndKnowhow.forEach(tip => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = tip.title;
                link.onclick = (event) => {
                    event.preventDefault();
                    showTipDetail(tip.id); // Lev.3으로 이동
                    setActiveListItem(link);
                };
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });
            // 첫 번째 항목 선택
            if (window.tipsAndKnowhow.length > 0) {
                listUl.querySelector('li a').click();
            }
        }


        // -- Level 3/4 상세 로드 함수들 --

        // Lev.3: 타입/등급에 따른 포켓몬 이름 목록 표시
        function showPokemonListByTypeOrGrade(filterValue, sectionType) {
            const currentSection = document.getElementById(`${sectionType}-section`);
            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3List = currentSection.querySelector(`#lv3-list-pokemon-by-${sectionType.split('-')[1]}`);
            const lv4Detail = currentSection.querySelector(`#lv4-detail-${sectionType}`);
            const listUl = lv3List.querySelector('ul');

            listUl.innerHTML = ''; // 기존 목록 비우기
            // LV4 상세 내용 초기화 (새로운 LV3 목록 선택 시)
            resetDetailContent(currentSection.querySelector(`#${sectionType}-detail-content`), sectionType);

            const filteredPokemons = window.pokemonData.filter(p => {
                if (sectionType === 'pokemon-type') {
                    return p.type.includes(filterValue);
                } else if (sectionType === 'pokemon-grade') {
                    return p.grade === filterValue;
                }
                return false;
            });

            if (filteredPokemons.length === 0) {
                listUl.innerHTML = `<li><p>해당 ${filterValue}에 맞는 포켓몬이 없습니다.</p></li>`;
                // LV4 영역에도 메시지 표시
                const lv4Content = currentSection.querySelector(`#${sectionType}-detail-content`);
                lv4Content.innerHTML = `<p class="text-center mt-4">해당 ${filterValue}에 맞는 포켓몬이 없습니다.</p>`;
            } else {
                filteredPokemons.forEach(pokemon => {
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = "#";
                    link.textContent = pokemon.name;
                    link.onclick = (event) => {
                        event.preventDefault();
                        showPokemonDetail(pokemon.id, sectionType); // Lev.4로 이동
                        setActiveListItem(link); // Lv3 목록 항목 활성화
                    };
                    listItem.appendChild(link);
                    listUl.appendChild(listItem);
                });
                // 첫 번째 포켓몬 상세 정보 바로 표시 (Lev.4)
                if (listUl.querySelector('li a')) {
                    listUl.querySelector('li a').click();
                }
            }

            // 화면 전환
            currentDetailLevel = 'lv3';
            if (!mediaQuery.matches) { // PC
                lv2List.style.display = 'block'; // LV2 목록 보임
                lv3List.style.display = 'block'; // LV3 목록 보임
                lv4Detail.style.display = 'block'; // LV4 상세도 보임 (3분할)
            } else { // Mobile
                lv2List.classList.remove('active-mobile-column'); // LV2 숨김
                lv2List.style.display = 'none';
                lv3List.classList.add('active-mobile-column'); // LV3 보임
                lv3List.style.display = 'block';
                lv4Detail.classList.remove('active-mobile-column'); // LV4 숨김
                lv4Detail.style.display = 'none';
            }
        }


        // Lev.3: 아이템/룬/칩 상세 정보 표시
        function showItemRuneChipDetail(name, type) {
            let dataObject;
            let detailContentId;
            if (type === 'item') { dataObject = window.itemDetails; detailContentId = 'item-detail-content'; }
            else if (type === 'rune') { dataObject = window.runeDetails; detailContentId = 'rune-detail-content'; }
            else if (type === 'chip') { dataObject = window.chipDetails; detailContentId = 'chip-detail-content'; }
            else return;

            const detailContentElement = document.getElementById(detailContentId);
            resetDetailContent(detailContentElement, type); // 내용 초기화

            const detail = dataObject[name];
            if (detail) {
                const img = detailContentElement.querySelector('img');
                const title = detailContentElement.querySelector('h4');
                const desc = detailContentElement.querySelector('p');

                if (img) {
                    img.src = detail.imageUrl || 'https://via.placeholder.com/100/CCCCCC/FFFFFF?text=No+Image';
                    img.alt = name + ' 이미지';
                    img.classList.remove('hidden');
                }
                if (title) title.textContent = name;
                if (desc) desc.innerHTML = detail.description.replace(/\n/g, '<br>');
            } else {
                detailContentElement.querySelector('h4').textContent = '정보 없음';
                detailContentElement.querySelector('p').textContent = '상세 정보를 불러올 수 없습니다.';
            }

            // 화면 전환 (아이템, 룬, 칩은 Lev.2 -> Lev.3으로 바로 상세)
            currentDetailLevel = 'lv3';
            const currentSection = document.getElementById(`${type}-section`);
            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3Detail = currentSection.querySelector(`#lv3-detail-${type}`);

            if (!mediaQuery.matches) { // PC
                lv2List.style.display = 'block';
                lv3Detail.style.display = 'block';
            } else { // Mobile
                lv2List.classList.remove('active-mobile-column'); // LV2 숨김
                lv2List.style.display = 'none';
                lv3Detail.classList.add('active-mobile-column'); // LV3 보임
                lv3Detail.style.display = 'block';
            }
        }

        // Lev.3: 추천 덱 상세 정보 표시
        function showRecommendedDeckDetail(deckType) {
            const currentSection = document.getElementById('recommended-decks-section');
            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3Detail = currentSection.querySelector('#lv3-detail-recommended-decks');
            const detailContentElement = currentSection.querySelector('#recommended-decks-detail-content');
            resetDetailContent(detailContentElement, 'recommended-decks'); // 내용 초기화

            let selectedDeck = null;
            let decksToShow = [];

            if (deckType === '전체 덱') {
                decksToShow = Object.values(window.recommendedDeckDetails);
            } else {
                for (const deckName in window.recommendedDeckDetails) {
                    const deck = window.recommendedDeckDetails[deckName];
                    if (deck.type === deckType) {
                        decksToShow.push(deck);
                    }
                }
            }

            if (decksToShow.length > 0) {
                // 여러 덱이 있을 경우, 첫 번째 덱의 상세 정보만 표시 (요청: 최종 선택한 덱 이미지 나타나기)
                selectedDeck = decksToShow[0];

                const img = detailContentElement.querySelector('img');
                const title = detailContentElement.querySelector('h4');
                const desc = detailContentElement.querySelector('p#recommended-decks-description');
                const pokemonsSpan = detailContentElement.querySelector('#recommended-decks-pokemons');
                const strategySpan = detailContentElement.querySelector('#recommended-decks-strategy');

                if (img) {
                    img.src = selectedDeck.imageUrl || 'https://via.placeholder.com/150/FFD700/000000?text=Deck';
                    img.alt = selectedDeck.name || '덱 이미지';
                    img.classList.remove('hidden');
                }
                if (title) title.textContent = selectedDeck.name || "선택된 덱";
                if (desc) desc.innerHTML = selectedDeck.description.replace(/\n/g, '<br>');
                if (pokemonsSpan) pokemonsSpan.textContent = selectedDeck.pokemons ? selectedDeck.pokemons.join(', ') : '정보 없음';
                if (strategySpan) strategySpan.textContent = selectedDeck.strategy || '정보 없음';

            } else {
                detailContentElement.querySelector('h4').textContent = '선택된 덱 없음';
                detailContentElement.querySelector('p#recommended-decks-description').textContent = '덱을 선택하여 상세 정보를 확인하세요.';
                detailContentElement.querySelector('img')?.classList.add('hidden');
            }

            currentDetailLevel = 'lv3';
            if (!mediaQuery.matches) { // PC
                lv2List.style.display = 'block';
                lv3Detail.style.display = 'block';
            } else { // Mobile
                lv2List.classList.remove('active-mobile-column'); // LV2 숨김
                lv2List.style.display = 'none';
                lv3Detail.classList.add('active-mobile-column'); // LV3 보임
                lv3Detail.style.display = 'block';
            }
        }


        // Lev.3: 캘린더 이벤트 목록 표시
        function showCalendarEventsByType(eventType) {
            const currentSection = document.getElementById('calendar-section');
            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3Detail = currentSection.querySelector('#lv3-detail-calendar');
            const detailContentElement = currentSection.querySelector('#calendar-detail-content');
            resetDetailContent(detailContentElement, 'calendar'); // 내용 초기화

            const filteredEvents = window.calendarEvents.filter(event => event.type === eventType);

            if (filteredEvents.length === 0) {
                detailContentElement.innerHTML += `<p class="text-center mt-4">${eventType} 타입의 일정이 없습니다.</p>`;
            } else {
                detailContentElement.innerHTML += `<h3 class="text-xl font-bold mb-4">${eventType} 이벤트 일정</h3>`;
                filteredEvents.forEach(event => {
                    const eventCard = `
                        <div class="bg-white p-4 rounded-lg shadow-md mb-3">
                            <h4 class="text-lg font-semibold">${event.title}</h4>
                            <p class="text-sm"><strong>날짜:</strong> ${event.date} <strong>시간:</strong> ${event.time}</p>
                            <p class="text-sm">${event.description}</p>
                            ${event.imageUrl ? `<img src="${event.imageUrl}" alt="${event.title}" class="mt-2 w-full h-24 object-cover rounded-md">` : ''}
                        </div>
                    `;
                    detailContentElement.innerHTML += eventCard;
                });
            }

            currentDetailLevel = 'lv3';
            if (!mediaQuery.matches) { // PC
                lv2List.style.display = 'block';
                lv3Detail.style.display = 'block';
            } else { // Mobile
                lv2List.classList.remove('active-mobile-column'); // LV2 숨김
                lv2List.style.display = 'none';
                lv3Detail.classList.add('active-mobile-column'); // LV3 보임
                lv3Detail.style.display = 'block';
            }
        }

        // Lev.3: 팁 & 노하우 상세 내용 표시
        function showTipDetail(tipId) {
            const currentSection = document.getElementById('tips-knowhow-section');
            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3Detail = currentSection.querySelector('#lv3-detail-tips-knowhow');
            const detailContentElement = currentSection.querySelector('#tips-knowhow-detail-content');
            resetDetailContent(detailContentElement, 'tips-knowhow'); // 내용 초기화

            const tip = window.tipsAndKnowhow.find(t => t.id === tipId);

            if (tip) {
                document.getElementById('tip-title').textContent = tip.title;
                document.getElementById('tip-author').textContent = tip.author;
                document.getElementById('tip-date').textContent = tip.date;
                document.getElementById('tip-content').innerHTML = tip.content;
            } else {
                document.getElementById('tip-title').textContent = '글을 찾을 수 없습니다.';
                document.getElementById('tip-author').textContent = '';
                document.getElementById('tip-date').textContent = '';
                document.getElementById('tip-content').innerHTML = '<p>해당하는 팁 & 노하우 글이 존재하지 않습니다.</p>';
            }

            currentDetailLevel = 'lv3';
            if (!mediaQuery.matches) { // PC
                lv2List.style.display = 'block';
                lv3Detail.style.display = 'block';
            } else { // Mobile
                lv2List.classList.remove('active-mobile-column'); // LV2 숨김
                lv2List.style.display = 'none';
                lv3Detail.classList.add('active-mobile-column'); // LV3 보임
                lv3Detail.style.display = 'block';
            }
        }

        // Lev.4: 특정 포켓몬의 상세 정보 표시 (타입/등급에서 호출)
        function showPokemonDetail(pokemonId, sectionType) {
            const pokemon = window.pokemonData.find(p => p.id === pokemonId);
            if (!pokemon) {
                console.error("포켓몬을 찾을 수 없습니다:", pokemonId);
                return;
            }

            const currentSection = document.getElementById(`${sectionType}-section`);
            const lv3List = currentSection.querySelector(`.level-column.detail-view[id^="lv3-list-"]`);
            const lv4Detail = currentSection.querySelector(`#lv4-detail-${sectionType}`);
            const detailContentElement = currentSection.querySelector(`#${sectionType}-detail-content`);
            resetDetailContent(detailContentElement, sectionType); // 내용 초기화

            // 스킬 정보 HTML 생성
            let skillsHtml = '';
            pokemon.skills.forEach(skill => {
                skillsHtml += `<p><strong>${skill.name}:</strong> ${skill.description}</p>`;
                if (skill.parts) { // 패시브 스킬의 세부 파츠가 있는 경우
                    skill.parts.forEach(part => {
                        skillsHtml += `<p style="margin-left: 20px;">- <strong>${part.title}:</strong> ${part.text}</p>`;
                    });
                }
            });

            // DOM 요소 업데이트 (HTML에 이미 있는 요소들)
            const imgElement = detailContentElement.querySelector('img');
            const titleElement = detailContentElement.querySelector('h4');
            const descElement = detailContentElement.querySelector('p:not(.text-sm.text-gray-600.mb-2)'); // 일반 설명 p
            const skillsDiv = detailContentElement.querySelector('[id$="-skills"]');

            if (imgElement) {
                imgElement.src = pokemon.image || 'https://via.placeholder.com/100/CCCCCC/FFFFFF?text=No+Image';
                imgElement.alt = pokemon.name;
                imgElement.classList.remove('hidden');
            }
            if (titleElement) titleElement.textContent = pokemon.name;
            if (descElement) descElement.innerHTML = pokemon.description.replace(/\n/g, '<br>');
            if (skillsDiv) skillsDiv.innerHTML = skillsHtml;

            document.getElementById(`${sectionType}-nature`).textContent = pokemon.nature.join(', ');
            document.getElementById(`${sectionType}-build`).textContent = pokemon.build.join(', ');

            // 아이템, 룬, 칩은 clickable-item 클래스와 onclick 이벤트 추가
            const itemSpan = document.getElementById(`${sectionType}-item`);
            if (itemSpan) {
                itemSpan.textContent = pokemon.item;
                itemSpan.classList.add('clickable-item');
                itemSpan.onclick = () => openModalItemDetail(pokemon.item, 'item');
            }
            const runesSpan = document.getElementById(`${sectionType}-runes`);
            if (runesSpan) {
                runesSpan.textContent = pokemon.runes.join(', ');
                runesSpan.classList.add('clickable-item');
                runesSpan.onclick = () => openModalItemDetail(pokemon.runes.map(r => r.split(' ')[0]), 'rune');
            }
            const chipsSpan = document.getElementById(`${sectionType}-chips`);
            if (chipsSpan) {
                chipsSpan.textContent = pokemon.chips.join(', ');
                chipsSpan.classList.add('clickable-item');
                chipsSpan.onclick = () => openModalItemDetail(pokemon.chips.map(c => c.split(' ')[0]), 'chip');
            }
            document.getElementById(`${sectionType}-team`).textContent = pokemon.team;

            // 화면 전환
            currentDetailLevel = 'lv4';
            if (!mediaQuery.matches) { // PC
                currentSection.querySelector('.level-column.list-view').style.display = 'block'; // LV2 (타입/등급 목록)
                lv3List.style.display = 'none'; // LV3 (포켓몬 이름 목록) 숨김
                lv4Detail.style.display = 'block'; // LV4 (포켓몬 상세) 보임
                // '이전으로 돌아가기' 버튼 텍스트 변경
                const backButton = lv4Detail.querySelector('.back-button');
                if (backButton) backButton.textContent = '목록으로 돌아가기';
            } else { // Mobile
                lv3List.classList.remove('active-mobile-column'); // LV3 숨김
                lv3List.style.display = 'none';
                lv4Detail.classList.add('active-mobile-column'); // LV4 보임
                lv4Detail.style.display = 'block';
                const backButton = lv4Detail.querySelector('.back-button');
                if (backButton) backButton.textContent = '이전으로 돌아가기';
            }
        }


        // -- 뒤로가기 버튼 로직 --

        // 포켓몬 섹션: Lev.4 (포켓몬 상세) -> Lev.3 (포켓몬 이름 목록)
        function backToLv3(sectionType) {
            const currentSection = document.getElementById(`${sectionType}-section`);
            const lv3List = currentSection.querySelector(`.level-column.detail-view[id^="lv3-list-"]`);
            const lv4Detail = currentSection.querySelector(`#lv4-detail-${sectionType}`);

            currentDetailLevel = 'lv3';
            if (!mediaQuery.matches) { // PC
                // PC에서는 LV2와 LV3가 동시에 보임 (LV4가 사라지고 LV3가 나타남)
                lv3List.style.display = 'block';
                lv4Detail.style.display = 'none'; // LV4 상세 숨김 (PC에서는 LV2+LV3 2분할)
            } else { // Mobile
                lv3List.classList.add('active-mobile-column');
                lv3List.style.display = 'block';
                lv4Detail.classList.remove('active-mobile-column');
                lv4Detail.style.display = 'none';
            }
            // 활성화된 LV3 목록 항목 (포켓몬 이름) 선택 해제
            const lv3ListUl = lv3List.querySelector('ul');
            if (lv3ListUl) {
                lv3ListUl.querySelectorAll('li a').forEach(link => link.classList.remove('active'));
            }
        }

        // 모든 섹션: Lev.3 (상세) 또는 Lev.3 (포켓몬 이름 목록) -> Lev.2 (카테고리 목록)
        function backToLv2(sectionType) {
            const currentSection = document.getElementById(`${sectionType}-section`);
            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3Detail = currentSection.querySelector(`.level-column.detail-view#lv3-detail-${sectionType}`); // 일반 상세
            const lv3ListPokemon = currentSection.querySelector(`.level-column.detail-view[id^="lv3-list-pokemon-"]`); // 포켓몬 이름 목록
            const lv4DetailPokemon = currentSection.querySelector(`.level-column.detail-view[id^="lv4-detail-pokemon-"]`); // 포켓몬 최종 상세

            currentDetailLevel = 'lv2';

            // 모든 상세 컬럼 숨김
            if (lv3Detail) { lv3Detail.classList.remove('active-mobile-column'); lv3Detail.style.display = 'none'; }
            if (lv3ListPokemon) { lv3ListPokemon.classList.remove('active-mobile-column'); lv3ListPokemon.style.display = 'none'; }
            if (lv4DetailPokemon) { lv4DetailPokemon.classList.remove('active-mobile-column'); lv4DetailPokemon.style.display = 'none'; }

            // LV2 목록 보임
            lv2List.classList.add('active-mobile-column');
            lv2List.style.display = 'block';

            // PC에서는 Lev2와 Lev3/4가 항상 보임 (컬럼 크기만 조절)
            if (!mediaQuery.matches) {
                if (lv3Detail) lv3Detail.style.display = 'block';
                // 포켓몬 섹션은 LV3 목록과 LV4 상세가 모두 보일 수 있도록
                if (lv3ListPokemon) lv3ListPokemon.style.display = 'block';
                if (lv4DetailPokemon) lv4DetailPokemon.style.display = 'block';
                // PC에서는 돌아가기 버튼 숨김
                currentSection.querySelectorAll('.level-column .back-button').forEach(btn => btn.style.display = 'none');
            }

            // 활성화된 LV2 목록 항목 선택 해제
            if (activeLv2ListItem) {
                activeLv2ListItem.classList.remove('active');
                activeLv2ListItem = null;
            }
            // 상세 내용 초기화 (다시 빈 상태로)
            resetDetailContent(currentSection.querySelector('.detail-content'), sectionType);
        }

        // 활성화된 LV2 목록 항목 스타일링 헬퍼
        function setActiveListItem(linkElement) {
            if (activeLv2ListItem) {
                activeLv2ListItem.classList.remove('active');
            }
            linkElement.classList.add('active');
            activeLv2ListItem = linkElement;
        }


        // -- 모달 관련 함수 --

        // 아이템/룬/칩 상세 모달 열기 (포켓몬 상세 화면에서 호출)
        function openModalItemDetail(nameOrNames, type) {
            let dataObject;
            let titleText = '';
            let defaultImage = '';

            if (type === 'item') {
                dataObject = window.itemDetails;
                titleText = '아이템 정보';
                defaultImage = 'https://via.placeholder.com/100/FF5733/FFFFFF?text=Item';
            } else if (type === 'rune') {
                dataObject = window.runeDetails;
                titleText = '룬 정보';
                defaultImage = 'https://via.placeholder.com/100/33FF57/FFFFFF?text=Rune';
            } else if (type === 'chip') {
                dataObject = window.chipDetails;
                titleText = '칩 정보';
                defaultImage = 'https://via.placeholder.com/100/3357FF/FFFFFF?text=Chip';
            } else {
                console.error("알 수 없는 모달 타입:", type);
                return;
            }

            const modalTitle = document.getElementById('generalModalTitle');
            const modalImage = document.getElementById('generalModalImage');
            const modalDescription = document.getElementById('generalModalDescription');
            const modal = document.getElementById('generalModal');

            modalTitle.textContent = titleText;
            modalImage.classList.add('hidden');
            modalDescription.innerHTML = ''; // 초기화

            let detailsHtml = '';

            // 여러 이름이 배열로 넘어올 경우 (룬, 칩)
            const names = Array.isArray(nameOrNames) ? nameOrNames : [nameOrNames];

            if (names.length > 0) {
                names.forEach(name => {
                    const detail = dataObject[name.trim()]; // 공백 제거
                    if (detail) {
                        detailsHtml += `<h5 class="font-bold text-lg mt-3">${name.trim()}</h5>`;
                        detailsHtml += `<p>${detail.description.replace(/\n/g, '<br>')}</p>`;
                        if (detail.imageUrl && !modalImage.src) { // 첫 이미지일 경우에만 설정
                             modalImage.src = detail.imageUrl;
                             modalImage.classList.remove('hidden');
                        }
                    } else {
                        detailsHtml += `<h5 class="font-bold text-lg mt-3">${name.trim()}</h5>`;
                        detailsHtml += `<p>정보를 찾을 수 없습니다.</p>`;
                    }
                });
            } else {
                detailsHtml = '<p>선택된 항목이 없습니다.</p>';
            }

            modalDescription.innerHTML = detailsHtml;

            // 만약 이미지가 하나도 설정되지 않았다면 기본 플레이스홀더 이미지 사용
            if (modalImage.classList.contains('hidden')) {
                modalImage.src = defaultImage;
                modalImage.classList.remove('hidden');
            }

            modal.style.display = 'flex'; // 모달 표시
        }

        // 모달 닫기 함수
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }


        // -- AdSense 광고 로드 함수 --
        let adRetryCount = 0;
        const maxAdRetries = 5;

        function showAd() {
            console.log("AdSense 광고 로드 시도...");
            const adsContainer = document.getElementById('top-ad-container');
            if (adsContainer) {
                // 기존 광고를 제거하고 새로운 광고를 요청
                adsContainer.innerHTML = `
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-client="${adClient}"
                         data-ad-slot="${adSlot}"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                `;
                
                // Google Adsense 라이브러리가 로드되었는지 확인 후 광고 푸시
                if (typeof (adsbygoogle) !== 'undefined' && Array.isArray(window.adsbygoogle) && window.adsbygoogle.length > 0) {
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    console.log("AdSense 광고 요청 푸시 완료.");
                    adRetryCount = 0; // 성공 시 재시도 카운트 초기화
                } else if (adRetryCount < maxAdRetries) {
                    console.warn(`AdSense 라이브러리가 아직 로드되지 않았거나 배열이 비어있습니다. ${adRetryCount + 1}/${maxAdRetries} 재시도합니다.`);
                    adRetryCount++;
                    setTimeout(showAd, 500); // 0.5초 후 재시도
                } else {
                    console.error("AdSense 광고 로드 실패: 최대 재시도 횟수 초과.");
                    adRetryCount = 0; // 카운트 초기화
                }
            }
        }


        // 초기 로드 시 "환영합니다" 섹션 활성화 및 광고 로드
        document.addEventListener('DOMContentLoaded', () => {
            // 초기에는 빈 화면 (Lev.1 사이드바 + 우측 공란)
            document.getElementById('initial-blank-section').classList.add('active');
            showAd(); // 초기 광고 로드
        });

        // 반응형 동작 감지 및 처리
        function handleMediaQueryChange(e) {
            const currentSection = document.getElementById(activeSectionId);
            if (!currentSection || currentSection.id === 'initial-blank-section') return; // 초기 빈 화면은 처리 안함

            const lv2List = currentSection.querySelector('.level-column.list-view');
            const lv3ListPokemon = currentSection.querySelector('.level-column.detail-view[id^="lv3-list-pokemon-"]');
            const lv4DetailPokemon = currentSection.querySelector('.level-column.detail-view[id^="lv4-detail-pokemon-"]');
            const lv3DetailGeneric = currentSection.querySelector(`.level-column.detail-view#lv3-detail-${activeSectionId.replace('-section', '')}`);


            if (e.matches) { // 모바일 (1024px 이하)
                // 모든 컬럼 숨김 (JS가 제어)
                currentSection.querySelectorAll('.level-column').forEach(col => col.style.display = 'none');

                // 현재 활성화된 레벨에 따라 컬럼 표시
                if (currentDetailLevel === 'lv2') {
                    if (lv2List) lv2List.style.display = 'block';
                } else if (currentDetailLevel === 'lv3') {
                    if (lv3DetailGeneric && lv3DetailGeneric.id === `lv3-detail-${activeSectionId.replace('-section', '')}`) { // 일반 상세
                        lv3DetailGeneric.style.display = 'block';
                    } else if (lv3ListPokemon && lv3ListPokemon.id === `lv3-list-pokemon-by-${activeSectionId.replace('-section', '').replace('pokemon-', '')}`) { // 포켓몬 이름 목록
                        lv3ListPokemon.style.display = 'block';
                    }
                } else if (currentDetailLevel === 'lv4') {
                    if (lv4DetailPokemon) lv4DetailPokemon.style.display = 'block';
                }
            } else { // PC (1024px 초과)
                // 모든 관련 컬럼을 보이게 (2분할 또는 3분할)
                if (lv2List) lv2List.style.display = 'block';

                if (activeSectionId.startsWith('pokemon')) { // 포켓몬 타입/등급 섹션
                    if (currentDetailLevel === 'lv4') {
                        // LV2 (타입/등급 목록) + LV4 (포켓몬 상세) 2분할
                        if (lv3ListPokemon) lv3ListPokemon.style.display = 'none'; // LV3 포켓몬 이름 목록 숨김
                        if (lv4DetailPokemon) lv4DetailPokemon.style.display = 'block';
                    } else if (currentDetailLevel === 'lv3') {
                        // LV2 (타입/등급 목록) + LV3 (포켓몬 이름 목록) 2분할
                        if (lv3ListPokemon) lv3ListPokemon.style.display = 'block';
                        if (lv4DetailPokemon) lv4DetailPokemon.style.display = 'none'; // LV4 포켓몬 상세 숨김
                    } else { // lv2 상태 (처음 로드)
                        if (lv3ListPokemon) lv3ListPokemon.style.display = 'block'; // LV3도 보이게
                        if (lv4DetailPokemon) lv4DetailPokemon.style.display = 'block'; // LV4도 보이게 (초기에는 내용 없음)
                    }
                } else { // 일반 섹션 (아이템, 룬, 칩, 추천덱, 캘린더, 팁&노하우)
                    if (lv3DetailGeneric) lv3DetailGeneric.style.display = 'block';
                }
                // PC에서는 돌아가기 버튼 숨김
                currentSection.querySelectorAll('.level-column .back-button').forEach(btn => btn.style.display = 'none');
            }
        }

        // 미디어 쿼리 리스너 등록
        mediaQuery.addListener(handleMediaQueryChange);
        // 초기 로드 시 미디어 쿼리 상태 반영은 DOMContentLoaded에서 showSection 호출 후 자동으로 처리됨
    </script>
</body>
</html>
