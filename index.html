<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>포켓몬 도감</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            color: #333;
        }
        .sidebar {
            background-color: #2c3e50;
            color: #ecf0f1;
            width: 250px;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            height: 100%;
            overflow-y: auto;
            z-index: 500; /* Ensure sidebar is above content on smaller screens if needed */
        }
        .sidebar h2 {
            font-size: 1.8em;
            margin-bottom: 30px;
            color: #3498db;
            text-align: center;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
        }
        .sidebar ul li {
            margin-bottom: 10px;
        }
        .sidebar ul li a {
            color: #ecf0f1;
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .sidebar ul li a:hover, .sidebar ul li a.active {
            background-color: #34495e;
            color: #ffffff;
        }
        .content {
            margin-left: 250px;
            padding: 20px;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: none;
                padding: 10px;
            }
            .sidebar ul {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            .sidebar ul li {
                margin: 5px;
            }
            .content {
                margin-left: 0;
            }
        }

        .content-section {
            display: none;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .content-section.active {
            display: block;
        }
        .level-container {
            display: grid;
            grid-template-columns: 1fr 2fr; /* 1:2 비율로 두 개의 컬럼 */
            gap: 20px;
        }
        @media (max-width: 1024px) { /* Tablet and smaller */
            .level-container {
                grid-template-columns: 1fr; /* 모바일에서는 단일 컬럼 */
            }
            .level-container.toggle-view .level-column.list-view { display: none; }
            .level-container.toggle-view .level-column.detail-view { display: block; }
            .level-container.toggle-view .level-column.detail-view .back-button { display: block; }

            .level-container:not(.toggle-view) .level-column.list-view { display: block; }
            .level-container:not(.toggle-view) .level-column.detail-view { display: none; }
            .level-container:not(.toggle-view) .level-column.detail-view .back-button { display: none; }
        }

        .level-column {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
            min-height: 400px; /* 최소 높이 설정 */
            overflow-y: auto;
        }
        .level-column h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        .level-column ul {
            list-style: none;
            padding: 0;
        }
        .level-column ul li {
            margin-bottom: 8px;
        }
        .level-column ul li a {
            display: block;
            padding: 8px 10px;
            background-color: #ecf0f1;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s ease;
        }
        .level-column ul li a:hover, .level-column ul li a.active {
            background-color: #3498db;
            color: #fff;
        }
        .detail-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .detail-content h3 {
            font-size: 2em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .detail-content img {
            max-width: 150px;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .detail-content p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .detail-content strong {
            color: #3498db;
        }
        /* Mobile back button visibility handled by JS and media query class */
        .detail-content .back-button {
            display: none; /* Hidden by default and by media query unless actively set to block via JS */
        }
        .detail-content .pokemon-detail-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #eee;
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-body img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 15px;
        }
        .modal-body h4 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .modal-body p {
            line-height: 1.6;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>포켓몬 도감</h2>
        <ul>
            <li><a href="#" onclick="showSection('pokemon-type', this)" class="active">포켓몬 타입</a></li>
            <li><a href="#" onclick="showSection('pokemon-grade', this)">포켓몬 등급</a></li>
            <li><a href="#" onclick="showSection('item', this)">아이템</a></li>
            <li><a href="#" onclick="showSection('rune', this)">룬</a></li>
            <li><a href="#" onclick="showSection('chip', this)">칩</a></li>
            <li><a href="#" onclick="showSection('recommended-decks', this)">추천 덱</a></li>
            <li><a href="#" onclick="showSection('calendar', this)">캘린더</a></li>
            <li><a href="#" onclick="showSection('tips-knowhow', this)">팁 & 노하우</a></li>
        </ul>
    </div>

    <div class="content">
        <div id="pokemon-type-section" class="content-section active">
            <h1 class="text-3xl font-bold mb-4">포켓몬 타입 정보</h1>
            <div class="level-container" id="pokemon-type-level-container">
                <div class="level-column list-view" id="lv2-list-pokemon-type">
                    <h3>타입 목록</h3>
                    <ul id="pokemon-type-list">
                        </ul>
                </div>
                <div class="level-column detail-view" id="lv3-detail-pokemon-type">
                    <h3>포켓몬 상세 정보</h3>
                    <div id="pokemon-type-detail-content" class="detail-content pokemon-detail-section">
                        <button onclick="backToList('pokemon-type')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="pokemon-grade-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">포켓몬 등급 정보</h1>
            <div class="level-container" id="pokemon-grade-level-container">
                <div class="level-column list-view" id="lv2-list-pokemon-grade">
                    <h3>등급 목록</h3>
                    <ul id="pokemon-grade-list">
                        </ul>
                </div>
                <div class="level-column detail-view" id="lv3-detail-pokemon-grade">
                    <h3>포켓몬 상세 정보</h3>
                    <div id="pokemon-grade-detail-content" class="detail-content pokemon-detail-section">
                        <button onclick="backToList('pokemon-grade')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="item-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">아이템 정보</h1>
            <div class="level-container" id="item-level-container">
                <div class="level-column list-view" id="lv2-list-item">
                    <h3>아이템 목록</h3>
                    <ul id="item-list">
                        </ul>
                </div>
                <div class="level-column detail-view" id="lv3-detail-item">
                    <h3>상세 정보</h3>
                    <div id="item-detail-content" class="detail-content">
                        <img id="item-image" src="" alt="아이템 이미지" class="hidden">
                        <h4 id="item-title" class="text-xl font-bold mb-2"></h4>
                        <p id="item-description"></p>
                        <button onclick="backToList('item')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="rune-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">룬 정보</h1>
            <div class="level-container" id="rune-level-container">
                <div class="level-column list-view" id="lv2-list-rune">
                    <h3>룬 목록</h3>
                    <ul id="rune-list">
                        </ul>
                </div>
                <div class="level-column detail-view" id="lv3-detail-rune">
                    <h3>상세 정보</h3>
                    <div id="rune-detail-content" class="detail-content">
                        <img id="rune-image" src="" alt="룬 이미지" class="hidden">
                        <h4 id="rune-title" class="text-xl font-bold mb-2"></h4>
                        <p id="rune-description"></p>
                        <button onclick="backToList('rune')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="chip-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">칩 정보</h1>
            <div class="level-container" id="chip-level-container">
                <div class="level-column list-view" id="lv2-list-chip">
                    <h3>칩 목록</h3>
                    <ul id="chip-list">
                        </ul>
                </div>
                <div class="level-column detail-view" id="lv3-detail-chip">
                    <h3>상세 정보</h3>
                    <div id="chip-detail-content" class="detail-content">
                        <img id="chip-image" src="" alt="칩 이미지" class="hidden">
                        <h4 id="chip-title" class="text-xl font-bold mb-2"></h4>
                        <p id="chip-description"></p>
                        <button onclick="backToList('chip')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="recommended-decks-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">추천 덱</h1>
            <div class="level-container" id="recommended-decks-level-container">
                <div class="level-column list-view" id="lv2-list-recommended-decks">
                    <h3>덱 목록</h3>
                    <ul id="recommended-decks-list">
                        </ul>
                </div>
                <div class="level-column detail-view" id="lv3-detail-recommended-decks">
                    <h3>상세 정보</h3>
                    <div id="recommended-decks-detail-content" class="detail-content">
                        <img id="recommended-decks-image" src="" alt="덱 이미지" class="hidden">
                        <h4 id="recommended-decks-title" class="text-xl font-bold mb-2"></h4>
                        <p id="recommended-decks-description"></p>
                        <p><strong>구성 포켓몬:</strong> <span id="recommended-decks-pokemons"></span></p>
                        <p><strong>전략:</strong> <span id="recommended-decks-strategy"></span></p>
                        <button onclick="backToList('recommended-decks')" class="back-button bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">목록으로 돌아가기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="calendar-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">이벤트 캘린더</h1>
            <div id="calendar-events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </div>

        <div id="tips-knowhow-section" class="content-section">
            <h1 class="text-3xl font-bold mb-4">팁 & 노하우</h1>
            <div id="tips-list">
                </div>
        </div>
    </div>

    <div id="tipModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
            </div>
            <div class="modal-body" id="modalContent">
                </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // 현재 활성화된 섹션과 레벨2 목록 항목을 추적
        let activeSectionId = 'pokemon-type-section'; // 초기 활성화 섹션
        let activeLv2ListItem = null; // 현재 활성화된 lv2 목록 항목 (<a> 태그)

        // 미디어 쿼리 정의 (1024px 이하)
        const mediaQuery = window.matchMedia('(max-width: 1024px)');

        // 섹션 보이기/숨기기 함수
        function showSection(sectionId, clickedElement) {
            // 모든 섹션 숨기기
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            // 클릭된 섹션 보이기
            document.getElementById(sectionId + '-section').classList.add('active');

            // 사이드바 링크 활성화
            document.querySelectorAll('.sidebar ul li a').forEach(link => {
                link.classList.remove('active');
            });
            clickedElement.classList.add('active');

            // 현재 활성화된 섹션 ID 업데이트
            activeSectionId = sectionId + '-section';

            // 모든 level-container의 toggle-view 클래스 제거 및 초기화
            document.querySelectorAll('.level-container').forEach(container => {
                container.classList.remove('toggle-view');
                container.querySelector('.list-view').style.display = 'block'; // 목록 보이게
                container.querySelector('.detail-view').style.display = 'block'; // 상세도 보이게 (넓은 화면 기본)
                // 모바일에서는 상세가 숨겨져야 함
                if (mediaQuery.matches) {
                    container.querySelector('.detail-view').style.display = 'none';
                }
            });

            // 레벨3 상세 정보 및 LV2 목록 초기화
            resetAllDetailViews();
            activeLv2ListItem = null; // 활성화된 항목 초기화

            // 특정 섹션에 따라 내용 로드
            if (sectionId === 'pokemon-type') {
                loadDetailsList('pokemon-type');
            } else if (sectionId === 'pokemon-grade') {
                loadDetailsList('pokemon-grade');
            } else if (sectionId === 'item') {
                loadDetailsList('item');
            } else if (sectionId === 'rune') {
                loadDetailsList('rune');
            } else if (sectionId === 'chip') {
                loadDetailsList('chip');
            } else if (sectionId === 'recommended-decks') {
                loadDetailsList('recommended-decks');
            } else if (sectionId === 'calendar') {
                loadCalendarEvents();
            } else if (sectionId === 'tips-knowhow') {
                loadTipsAndKnowhow();
            }
        }

        // 모든 상세 정보 뷰 초기화 (요소는 유지하고 내용만 비움)
        function resetAllDetailViews() {
            // 모든 .detail-content 내부의 내용 초기화
            document.querySelectorAll('.detail-content').forEach(detailContent => {
                // img, h4, p, span 등 특정 ID를 가진 요소들의 내용을 비움
                const img = detailContent.querySelector('img');
                if (img) { img.src = ''; img.alt = ''; img.classList.add('hidden'); }
                const h4 = detailContent.querySelector('h4');
                if (h4) h4.textContent = '';
                const p = detailContent.querySelector('p');
                if (p) p.textContent = '';
                const spans = detailContent.querySelectorAll('span'); // 모든 span (성격, 빌드 등)
                spans.forEach(span => span.textContent = '');
                const divs = detailContent.querySelectorAll('div[id$="-skills"], div[id$="-info"]'); // 스킬 등 동적 내용
                divs.forEach(div => div.innerHTML = '');

                // 특정 섹션의 '구성 포켓몬', '전략' 텍스트 초기화
                const pokemonsSpan = detailContent.querySelector('[id$="-pokemons"]');
                if (pokemonsSpan) pokemonsSpan.textContent = '';
                const strategySpan = detailContent.querySelector('[id$="-strategy"]');
                if (strategySpan) strategySpan.textContent = '';

                // 포켓몬 상세 정보에 사용되는 동적 카드 컨테이너 초기화
                const pokemonDetailSection = detailContent.closest('.pokemon-detail-section');
                if (pokemonDetailSection) {
                    // "목록으로 돌아가기" 버튼을 제외한 모든 자식 노드 제거
                    Array.from(pokemonDetailSection.children).forEach(child => {
                        if (!child.classList.contains('back-button')) {
                            child.remove();
                        }
                    });
                }
            });

            // 모든 레벨2 목록 비우기 (새로 채워질 것이므로)
            document.querySelectorAll('.level-column ul').forEach(ul => {
                ul.innerHTML = '';
            });
        }

        // 일반화된 목록 로드 함수
        function loadDetailsList(type) {
            let dataObject;
            let listElementId;
            let defaultImage = ''; // 일반 아이템/룬/칩/덱의 기본 이미지

            // 데이터와 DOM ID 매핑
            if (type === 'item') {
                dataObject = window.itemDetails;
                listElementId = 'item-list';
                defaultImage = 'https://via.placeholder.com/100/FF5733/FFFFFF?text=Item';
            } else if (type === 'rune') {
                dataObject = window.runeDetails;
                listElementId = 'rune-list';
                defaultImage = 'https://via.placeholder.com/100/33FF57/FFFFFF?text=Rune';
            } else if (type === 'chip') {
                dataObject = window.chipDetails;
                listElementId = 'chip-list';
                defaultImage = 'https://via.placeholder.com/100/3357FF/FFFFFF?text=Chip';
            } else if (type === 'pokemon-type') {
                // 포켓몬 타입은 특별 처리: 중복 방지를 위해 Set 사용
                const uniqueTypes = new Set();
                window.pokemonData.forEach(p => p.type.forEach(t => uniqueTypes.add(t)));
                dataObject = {};
                Array.from(uniqueTypes).sort().forEach(t => { // 타입명으로 정렬
                    dataObject[t] = { description: `${t} 타입 포켓몬 목록` }; // 이미지 URL은 showDetail에서 직접 가져올 것이므로 필요 없음
                });
                listElementId = 'pokemon-type-list';
            } else if (type === 'pokemon-grade') {
                // 포켓몬 등급은 특별 처리: 중복 방지를 위해 Set 사용
                const uniqueGrades = new Set();
                window.pokemonData.forEach(p => uniqueGrades.add(p.grade));
                dataObject = {};
                Array.from(uniqueGrades).sort((a,b) => { // 등급 순서 정렬
                    const gradeOrder = {'SS':3, 'S+':2, 'S':1};
                    return (gradeOrder[b] || 0) - (gradeOrder[a] || 0);
                }).forEach(g => {
                    dataObject[g] = { description: `${g} 등급 포켓몬 목록` };
                });
                listElementId = 'pokemon-grade-list';
            } else if (type === 'recommended-decks') {
                dataObject = window.recommendedDeckDetails;
                listElementId = 'recommended-decks-list';
                defaultImage = 'https://via.placeholder.com/100/FFD700/000000?text=Deck';
            } else {
                console.error("알 수 없는 타입:", type);
                return;
            }

            const listUl = document.getElementById(listElementId);
            if (!listUl) {
                console.error(`Error: Element with ID ${listElementId} not found.`);
                return;
            }
            listUl.innerHTML = ''; // 기존 목록 비우기

            const keys = Object.keys(dataObject);
            keys.forEach(key => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = "#";
                link.textContent = key;
                link.onclick = (function(itemName, itemType) {
                    return function(event) {
                        event.preventDefault(); // 기본 링크 동작 방지
                        showDetail(itemName, itemType);

                        // 활성화된 lv2 항목 스타일링
                        if (activeLv2ListItem) {
                            activeLv2ListItem.classList.remove('active');
                        }
                        link.classList.add('active');
                        activeLv2ListItem = link;

                        if (mediaQuery.matches) { // 모바일 환경에서만 토글
                            document.getElementById(`${itemType}-level-container`).classList.add('toggle-view');
                            document.getElementById(`lv2-list-${itemType}`).style.display = 'none';
                            document.getElementById(`lv3-detail-${itemType}`).style.display = 'block';
                        }
                    };
                })(key, type);
                listItem.appendChild(link);
                listUl.appendChild(listItem);
            });

            // 첫 번째 항목의 상세 정보를 기본으로 표시
            if (keys.length > 0) {
                // 첫 번째 항목 클릭 이벤트 수동 실행 (상세 정보 로드 및 활성화 스타일 적용)
                const firstLink = listUl.querySelector('li a');
                if (firstLink) {
                    firstLink.click(); // showDetail 및 스타일 적용
                }
            } else {
                // 목록이 비어있을 경우 상세 내용 초기화
                const detailContentId = `${type}-detail-content`;
                const detailContentElement = document.getElementById(detailContentId);
                if (detailContentElement) {
                    resetDetailContent(detailContentElement, type); // 내용만 비우고 버튼 유지
                    const h4 = detailContentElement.querySelector('h4');
                    if (h4) h4.textContent = '선택할 항목 없음';
                    const p = detailContentElement.querySelector('p');
                    if (p) p.textContent = '목록에 항목이 없습니다.';
                }
            }
        }


        // 일반화된 상세 정보 표시 함수 (요소 ID를 직접 사용)
        function showDetail(name, type) {
            let dataObject;
            let detailContainerId;
            let currentDetailContentElement; // 현재 섹션의 detail-content div

            // 1. 데이터 및 DOM 요소 ID 설정
            if (type === 'item') {
                dataObject = window.itemDetails;
                detailContainerId = 'item-detail-content';
            } else if (type === 'rune') {
                dataObject = window.runeDetails;
                detailContainerId = 'rune-detail-content';
            } else if (type === 'chip') {
                dataObject = window.chipDetails;
                detailContainerId = 'chip-detail-content';
            } else if (type === 'pokemon-type' || type === 'pokemon-grade') {
                // 포켓몬 타입/등급은 loadPokemonByTypeOrGrade가 상세 내용을 채움
                loadPokemonByTypeOrGrade(name, type);
                // 모바일 환경에서 상세 보기 모드로 전환
                if (mediaQuery.matches) {
                    document.getElementById(`${type}-level-container`).classList.add('toggle-view');
                }
                return; // 이 경우 showDetail은 여기서 종료
            } else if (type === 'recommended-decks') {
                dataObject = window.recommendedDeckDetails;
                detailContainerId = 'recommended-decks-detail-content';
            } else {
                console.error("알 수 없는 타입:", type);
                return;
            }

            currentDetailContentElement = document.getElementById(detailContainerId);
            if (!currentDetailContentElement) {
                console.error(`Error: Detail element with ID ${detailContainerId} not found.`);
                return;
            }

            // 2. 상세 정보 영역 초기화 (버튼을 제외한 나머지 요소들을 초기 상태로)
            resetDetailContent(currentDetailContentElement, type);


            // 3. 데이터 로드 및 표시
            const detail = dataObject[name];

            if (detail) {
                const imgElement = currentDetailContentElement.querySelector('img');
                const titleElement = currentDetailContentElement.querySelector('h4');
                const descriptionElement = currentDetailContentElement.querySelector('p');

                if (imgElement && detail.imageUrl) {
                    imgElement.src = detail.imageUrl;
                    imgElement.alt = name + ' 이미지';
                    imgElement.classList.remove('hidden');
                } else if (imgElement) { // imageUrl이 없는 경우 숨김
                    imgElement.classList.add('hidden');
                }

                if (titleElement) {
                    titleElement.textContent = name;
                }
                if (descriptionElement) {
                    descriptionElement.innerHTML = detail.description.replace(/\n/g, '<br>');
                }

                // 추천 덱 추가 정보
                if (type === 'recommended-decks') {
                    const pokemonsSpan = document.getElementById('recommended-decks-pokemons');
                    const strategySpan = document.getElementById('recommended-decks-strategy');
                    if (pokemonsSpan) pokemonsSpan.textContent = detail.pokemons ? detail.pokemons.join(', ') : '정보 없음';
                    if (strategySpan) strategySpan.textContent = detail.strategy || '정보 없음';
                }

            } else {
                // 데이터가 없을 경우 기본 메시지 표시
                const imgElement = currentDetailContentElement.querySelector('img');
                if (imgElement) imgElement.classList.add('hidden');
                const titleElement = currentDetailContentElement.querySelector('h4');
                if (titleElement) titleElement.textContent = '선택된 항목 없음';
                const descriptionElement = currentDetailContentElement.querySelector('p');
                if (descriptionElement) descriptionElement.textContent = '항목을 선택하여 상세 정보를 확인하세요.';
            }

            // 4. 모바일 환경에서 상세 보기 모드로 전환
            if (mediaQuery.matches) {
                document.getElementById(`${type}-level-container`).classList.add('toggle-view');
            }
        }

        // 상세 정보 컨테이너의 내용을 초기화하는 헬퍼 함수
        function resetDetailContent(detailContentElement, type) {
            // 이미지, 제목, 설명, 스킬 등 동적으로 채워지는 요소들을 초기화
            const img = detailContentElement.querySelector('img');
            if (img) { img.src = ''; img.alt = ''; img.classList.add('hidden'); }
            const h4 = detailContentElement.querySelector('h4');
            if (h4) h4.textContent = '';
            const p = detailContentElement.querySelector('p');
            if (p) p.textContent = '';

            // 포켓몬 상세 정보 관련 span/div 초기화
            if (type === 'pokemon-type' || type === 'pokemon-grade') {
                const pokemonSkillsDiv = detailContentElement.querySelector('[id$="-skills"]');
                if (pokemonSkillsDiv) pokemonSkillsDiv.innerHTML = '';
                const natureSpan = detailContentElement.querySelector('[id$="-nature"]');
                if (natureSpan) natureSpan.textContent = '';
                const buildSpan = detailContentElement.querySelector('[id$="-build"]');
                if (buildSpan) buildSpan.textContent = '';
                const itemSpan = detailContentElement.querySelector('[id$="-item"]');
                if (itemSpan) itemSpan.textContent = '';
                const runesSpan = detailContentElement.querySelector('[id$="-runes"]');
                if (runesSpan) runesSpan.textContent = '';
                const chipsSpan = detailContentElement.querySelector('[id$="-chips"]');
                if (chipsSpan) chipsSpan.textContent = '';
                const teamSpan = detailContentElement.querySelector('[id$="-team"]');
                if (teamSpan) teamSpan.textContent = '';

                // 동적으로 추가된 pokemon-detail-card 요소들 제거 (버튼 제외)
                Array.from(detailContentElement.children).forEach(child => {
                    if (child.classList.contains('pokemon-detail-card') || (child.tagName === 'H3' && child.textContent.includes('타입' || '등급'))) {
                        child.remove();
                    }
                });
            } else if (type === 'recommended-decks') {
                const pokemonsSpan = detailContentElement.querySelector('[id$="-pokemons"]');
                if (pokemonsSpan) pokemonsSpan.textContent = '';
                const strategySpan = detailContentElement.querySelector('[id$="-strategy"]');
                if (strategySpan) strategySpan.textContent = '';
            }

            // 돌아가기 버튼 보이게 설정 (미디어 쿼리가 처리)
            const backButton = detailContentElement.querySelector('.back-button');
            if (backButton) {
                backButton.style.display = ''; // CSS가 처리하도록 놔둠
            }
        }


        // 포켓몬 타입 또는 등급별 상세 정보 로드 (목록 아님!)
        function loadPokemonByTypeOrGrade(filterValue, type) {
            const detailContainerId = `${type}-detail-content`;
            const detailElement = document.getElementById(detailContainerId);
            if (!detailElement) {
                console.error(`Error: Detail element with ID ${detailContainerId} not found.`);
                return;
            }

            // 초기화 (버튼 제외)
            resetDetailContent(detailElement, type);

            // 제목 추가
            const titleElement = document.createElement('h3');
            titleElement.className = 'text-xl font-bold mb-4';
            titleElement.textContent = `${filterValue} ${type === 'pokemon-type' ? '타입' : '등급'} 포켓몬`;
            detailElement.insertBefore(titleElement, detailElement.querySelector('.back-button') ? detailElement.querySelector('.back-button').nextSibling : null);


            const filteredPokemons = window.pokemonData.filter(pokemon => {
                if (type === 'pokemon-type') {
                    return pokemon.type.includes(filterValue);
                } else if (type === 'pokemon-grade') {
                    return pokemon.grade === filterValue;
                }
                return false;
            });

            if (filteredPokemons.length === 0) {
                const noPokemonP = document.createElement('p');
                noPokemonP.textContent = `해당 ${filterValue}에 해당하는 포켓몬이 없습니다.`;
                detailElement.appendChild(noPokemonP);
                return;
            }

            filteredPokemons.forEach(pokemon => {
                let skillsHtml = '';
                pokemon.skills.forEach(skill => {
                    skillsHtml += `<p><strong>${skill.name}:</strong> ${skill.description}</p>`;
                    if (skill.parts) {
                        skill.parts.forEach(part => {
                            skillsHtml += `<p style="margin-left: 20px;">- <strong>${part.title}:</strong> ${part.text}</p>`;
                        });
                    }
                });

                const pokemonDetailHtml = `
                    <div class="pokemon-detail-card">
                        <div class="flex items-center space-x-4 mb-4">
                            <img src="${pokemon.image || 'https://via.placeholder.com/100/CCCCCC/FFFFFF?text=No+Image'}" alt="${pokemon.name}" class="w-24 h-24 object-cover rounded-full shadow-md">
                            <div>
                                <h4 class="text-2xl font-bold">${pokemon.name}</h4>
                                <p class="text-lg"><strong>등급:</strong> ${pokemon.grade}</p>
                                <p class="text-lg"><strong>타입:</strong> ${pokemon.type.join(', ')}</p>
                            </div>
                        </div>
                        <p class="mb-4">${pokemon.description}</p>
                        <h5 class="text-xl font-bold mb-2">스킬:</h5>
                        ${skillsHtml}
                        <p class="mt-4"><strong>성격:</strong> ${pokemon.nature.join(', ')}</p>
                        <p><strong>빌드:</strong> ${pokemon.build.join(', ')}</p>
                        <p><strong>아이템:</strong> ${pokemon.item}</p>
                        <p><strong>룬:</strong> ${pokemon.runes.join(', ')}</p>
                        <p><strong>칩:</strong> ${pokemon.chips.join(', ')}</p>
                        <p><strong>추천 팀:</strong> ${pokemon.team}</p>
                    </div>
                `;
                detailElement.innerHTML += pokemonDetailHtml;
            });

            // 모바일 환경에서 상세 보기 모드로 전환
            if (mediaQuery.matches) {
                document.getElementById(`${type}-level-container`).classList.add('toggle-view');
            }
        }


        // 목록으로 돌아가기 버튼 클릭 시
        function backToList(type) {
            document.getElementById(`${type}-level-container`).classList.remove('toggle-view');
            document.getElementById(`lv2-list-${type}`).style.display = 'block';
            document.getElementById(`lv3-detail-${type}`).style.display = 'none';

            // 활성화된 lv2 항목 선택 해제
            if (activeLv2ListItem) {
                activeLv2ListItem.classList.remove('active');
                activeLv2ListItem = null;
            }
        }

        // 캘린더 이벤트 로드 함수
        function loadCalendarEvents() {
            const calendarEventsDiv = document.getElementById('calendar-events');
            calendarEventsDiv.innerHTML = ''; // 기존 이벤트 비우기

            window.calendarEvents.forEach(event => {
                const eventCard = `
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-2">${event.title}</h3>
                        <p><strong>날짜:</strong> ${event.date}</p>
                        <p><strong>시간:</strong> ${event.time}</p>
                        <p><strong>타입:</strong> ${event.type}</p>
                        <p class="text-sm mt-2">${event.description}</p>
                        ${event.imageUrl ? `<img src="${event.imageUrl}" alt="${event.title}" class="mt-2 w-full h-32 object-cover rounded-md">` : ''}
                    </div>
                `;
                calendarEventsDiv.innerHTML += eventCard;
            });
        }

        // 팁 & 노하우 로드 함수
        function loadTipsAndKnowhow() {
            const tipsListDiv = document.getElementById('tips-list');
            tipsListDiv.innerHTML = ''; // 기존 목록 비우기

            window.tipsAndKnowhow.forEach(tip => {
                const tipCard = `
                    <div class="bg-white p-4 rounded-lg shadow-md mb-4">
                        <h3 class="text-xl font-semibold mb-2">${tip.title}</h3>
                        <p class="text-sm text-gray-600 mb-2">작성자: ${tip.author} | 날짜: ${tip.date}</p>
                        <button onclick="openTipModal('${tip.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">내용 보기</button>
                    </div>
                `;
                tipsListDiv.innerHTML += tipCard;
            });
        }

        // 팁 모달 열기 함수
        function openTipModal(tipId) {
            const tip = window.tipsAndKnowhow.find(t => t.id === tipId);
            if (tip) {
                document.getElementById('modalTitle').textContent = tip.title;
                document.getElementById('modalContent').innerHTML = tip.content;
                document.getElementById('tipModal').style.display = 'flex'; // Flexbox로 중앙 정렬
            }
        }

        // 모달 닫기 함수
        function closeModal() {
            document.getElementById('tipModal').style.display = 'none';
        }

        // 초기 로드 시 "포켓몬 타입" 섹션 활성화
        document.addEventListener('DOMContentLoaded', () => {
            showSection('pokemon-type', document.querySelector('.sidebar ul li a.active'));
        });

        // 반응형 동작 감지 및 처리
        function handleMediaQueryChange(e) {
            // 미디어 쿼리가 일치하면 (화면이 좁으면)
            if (e.matches) {
                // 현재 활성화된 섹션이 목록-상세 구조이고 상세가 열려있다면 토글 뷰 적용
                const currentSectionId = activeSectionId.replace('-section', '');
                const levelContainer = document.getElementById(`${currentSectionId}-level-container`);
                if (levelContainer) {
                    const detailView = levelContainer.querySelector('.detail-view');
                    const listView = levelContainer.querySelector('.list-view');

                    if (levelContainer.classList.contains('toggle-view')) {
                        listView.style.display = 'none';
                        detailView.style.display = 'block';
                    } else { // 넓은 화면이었다가 좁아지면 목록부터 보이게
                        listView.style.display = 'block';
                        detailView.style.display = 'none';
                    }
                }
            } else { // 화면이 넓으면
                // 모든 level-container의 toggle-view 클래스 제거 및 원래대로 복원
                document.querySelectorAll('.level-container').forEach(container => {
                    container.classList.remove('toggle-view');
                    container.querySelector('.list-view').style.display = 'block';
                    container.querySelector('.detail-view').style.display = 'block'; // 넓은 화면에선 둘 다 보임
                });
            }
        }

        // 미디어 쿼리 리스너 등록
        mediaQuery.addListener(handleMediaQueryChange);

        // 초기 로드 시 미디어 쿼리 상태 반영
        handleMediaQueryChange(mediaQuery);

    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6447953289913217" crossorigin="anonymous"></script>
    <script>
        window.tailwind = {
            prefix: 'tw-', // Tailwind CSS 클래스 이름에 'tw-' 접두사 추가 (선택 사항)
            important: true, // 모든 Tailwind 클래스에 !important 추가 (선택 사항, 주의해서 사용)
        };
    </script>
</body>
</html>
